!function(){"use strict";angular.module("omr.directives",[]).directive("ngCamera",["$timeout",function(a){return{require:"ngModel",template:'<div class="ng-camera clearfix">        <p ng-hide="isLoaded">Loading Camera...</p>        <p ng-show="noCamera">Couldn\'t find a camera to use</p>        <div class="ng-camera-stack" ng-hide="!isLoaded">          <div class="ng-camera-countdown" ng-show="activeCountdown">            <p class="tick">{{countdownText}}</p>          </div>          <img class="ng-camera-overlay" ng-hide="!overlaySrc" ng-src="{{overlaySrc}}" width="{{width}}" height="{{height}}">          <video id="ng-camera-feed" autoplay width="{{width}}" height="{{height}}" src="{{videoStream}}">Install Browser\'s latest version</video>          <canvas id="ng-photo-canvas" width="{{width}}" height="{{height}}" style="display:none;"></canvas>        </div>        <div class="ng-camera-controls" ng-hide="hideUI">          <button class="btn ng-camera-take-btn" ng-click="takePicture()">Take Picture</button>        </div>      </div>',replace:!1,transclude:!0,restrict:"E",scope:{type:"@",media:"=ngModel",width:"@",height:"@",overlaySrc:"=",countdown:"@",captureCallback:"&capture",enabled:"=",captureMessage:"@"},link:function(b){return b.activeCountdown=!1,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,b.enableCamera=function(){return navigator.getUserMedia({audio:!1,video:!0},function(a){return b.$apply(function(){return b.isLoaded=!0,b.videoStream=window.URL.createObjectURL(a)})},function(){return b.$apply(function(){return b.isLoaded=!0,b.noCamera=!0})})},b.disableCamera=function(){return navigator.getUserMedia({audio:!1,video:!0},function(){return b.$apply(function(){return b.videoStream=""})})},b.takePicture=function(){var c,d,e,f;return c=window.document.getElementById("ng-photo-canvas"),f=null!=b.countdown?1e3*parseInt(b.countdown):0,null!=c&&(f>0&&(b.activeCountdown=!0,b.hideUI=!0),d=c.getContext("2d"),b.countdownTimer&&a.cancel(b.countdownTimer),b.countdownTimer=a(function(){var a;return b.activeCountdown=!1,a=window.document.getElementById("ng-camera-feed"),d.drawImage(a,0,0,b.width,b.height),null!=b.overlaySrc?b.addFrame(d,b.overlaySrc,function(){return b.$apply(function(){return b.media=c.toDataURL("image/jpeg")}),null!=b.captureCallback?b.captureCallback(b.media):void 0}):(b.media=c.toDataURL("image/jpeg"),null!=b.captureCallback&&b.captureCallback(b.media)),b.hideUI=!1},f+1e3),b.countdownText=parseInt(b.countdown),e=setInterval(function(){return b.$apply(function(){var a;return a=parseInt(b.countdownText)-1,0===a?(b.countdownText=null!=b.captureMessage?b.captureMessage:"GO!",clearInterval(e)):b.countdownText=a})},1e3)),!1},b.addFrame=function(a,c,d){var e;return null==d&&(d=!1),e=new Image,e.onload=function(){return a.drawImage(e,0,0,b.width,b.height),d?d(a):void 0},e.crossOrigin="",e.src=c},b.$watch("media",function(a){return null!=a?b.packagedMedia=b.media.replace(/^data:image\/\w+;base64,/,""):void 0}),b.$watch("overlaySrc",function(a){var c;return null!=b.overlaySrc?(b.isLoaded=!1,c=new Image,c.crossOrigin="",c.src=a,c.onload=function(){return b.$apply(function(){return b.isLoaded=!0})}):b.isLoaded=!0}),b.$watch("enabled",function(a,c){if(a){if(!c)return b.enableCamera()}else if(null!=c)return b.disableCamera()}),b.$watch("type",function(){switch(b.type){case"photo":if(b.enabled)return b.enableCamera();break;default:if(b.enabled)return b.enableCamera()}})}}}])}.call(this);